# 요기요 리뷰를 활용한 리뷰생성모델
2024.01.01~2024.06.15 동안 `'치킨', '피자/양식', '중국집', '한식', '일식/돈까스', '야식', '분식'`

음식 카테고리별로 `덕성여자대학교 주변 리뷰 많은 순으로 상위 5개` 가게에 작성된 리뷰 데이터를 모아 `kogpt-2 모델`을 파인튜닝 학습한 리뷰 생성 딥러닝 모델

------------------------------------

## Data   
1. 환경 설정   
  1.1 크롬 및 크롬 드라이버 설치 - `120.0.6099.71` 버전으로 다운그레이드/설치   
  1.2 `Selenium` 설치 - 동적 크롤링 도구   
  1.3 리뷰 데이터 크롤링 URL: [요기요](https://www.yogiyo.co.kr/mobile/#/)
2. 데이터 수집 과정   
  2.1 요기요 웹사이트 접속 및 `덕성여자대학교` 주소 입력   
  2.2 `7종류` 음식 카테고리 선택 및 `리뷰 많은 순` 정렬    
  2.3 음식점 리뷰 데이터 크롤링   
  + 각 카테고리에서 `상위 5개`의 음식점을 선택하고 해당 음식점 페이지 > 리뷰로 이동    
  + 목표 날짜(`2024년 1월 1일`)까지 리뷰를 로드
  + 각 리뷰에서 `맛/양/배달 평점`, `주문 아이템`, `리뷰 텍스트`를 추출   
  2.4 csv 파일로 데이터 저장
3. 데이터 수집 결과   
전처리 전: (17460, 7)   
전처리 후:   

| menu_category        | # of Sentence |
| ------------ | -------------: |
|치킨   |       1260   |
| 피자/양식 |          1470 |
|중국집 | 2200 |
|한식 | 480 |
| 일식/돈까스 | 990 |
| 야식 | 440 |
| 분식 | 1160 |
|  | 8000|

+ 한 가게가 여러 메뉴 카테고리에 속해 있어 메뉴 카테고리마다 중복되는 상호명 제거
+ 특수문자, 이모지, 영어 표현, 숫자 제거
+ 현실감 있는 리뷰 텍스트를 위해 오타, 띄어쓰기는 그대로 두어 형태소 분석, 불용어 제거 처리하지 않음   

## Pretrained model/Tokenizer
`skt/kogpt2` 모델과 토크나이저 이용   
1. Model

| Model       |  # of params |   Type   | # of layers  | # of heads | ffn_dim | hidden_dims |
|--------------|:----:|:-------:|--------:|--------:|--------:|--------------:|
| `kogpt2-base-v2` |  125M  |  Decoder |   12     | 12      | 3072    | 768 |   

2. Tokenizer   
[`tokenizers`](https://github.com/huggingface/tokenizers) 패키지의 `Character BPE tokenizer`로 학습됨

사전 크기는 51,200 이며 대화에 자주 쓰이는 아래와 같은 이모티콘, 이모지 등을 추가하여 해당 토큰의 인식 능력을 올림
> 😀, 😁, 😆, 😅, 🤣, .. , `:-)`, `:)`, `-)`, `(-:`...

```python
> from transformers import PreTrainedTokenizerFast
> tokenizer = PreTrainedTokenizerFast.from_pretrained("skt/kogpt2-base-v2",
  bos_token='</s>', eos_token='</s>', unk_token='<unk>',
  pad_token='<pad>', mask_token='<mask>')
> tokenizer.tokenize("안녕하세요. 한국어 GPT-2 입니다.😤:)l^o")
['▁안녕', '하', '세', '요.', '▁한국어', '▁G', 'P', 'T', '-2', '▁입', '니다.', '😤', ':)', 'l^o']
```

### 내부 동작 원리 (알고리즘)
```
Class CustomDataset(Dataset):
#  PyTorch의 Dataset 클래스를 상속받아 사용자 정의 데이터셋을 구현
텍스트 데이터를 받아 토큰화하고, 모델 학습에 적합한 입력 데이터로 변환하는 역할
__init__: 데이터셋을 초기화
__len__: 데이터셋의 크기를 반환
__getitem__: 주어진 인덱스에 해당하는 데이터를 토큰화하여 반환
```
+ 토크나이저 및 모델 로드: 지정된 경로에서 토크나이저와 모델을 불러옴
+ 패딩 토큰 설정: 필요한 경우 패딩 토큰을 설정
+ 데이터 로더 설정: 데이터셋과 데이터 로더를 생성
+ 최적화 및 스케줄러 설정: 옵티마이저와 학습 스케줄러를 설정
+ 디바이스 설정 및 모델 학습 모드로 전환: 모델을 적절한 디바이스에 할당하고 학습 모드로 전환
+ 학습 루프: 각 에폭에 대해 손실을 계산하고 모델 파라미터를 업데이트
+ 모델 및 토크나이저 저장: 학습이 완료된 후 모델과 토크나이저를 저장

**주요 하이퍼파라미터**
1. batch_size: 32
2. epochs: 5
3. learning_rate: 5e-5
4. max_length:50 (CustomDataset 클래스에서 설정)
5. num_workers: 2
6. early_stopping_patience:3 (EarlyStoppingCallback에서 설정 가능)

**trian_loss: 0.531**

### 문장 생성
```commandline
Input: 오늘은
Output: 오늘은 좀 덜 매웠어요 그래도 맛있게 잘 먹었습니다 오늘도 감사합니다  맛있습니당  맵찔이라서 퍽퍽한데 쫄깃해서 좋았어용`
```
```commandline
Input: 배달
Output: 배달도 빠르고 맛있어요  서비스도 감사합니다 서비스로 주신 막국수도 맛있게 잘 먹었습니다 짬뽕국물 감사해요 짱 감사드려요 감사드립니당
```
```commandline
Input: 하..
Output: 하.. 맛있어요  서비스 감사합니다 서비스로 주신 떡사리도 감사히 잘 먹었습니다   번창하세요  감사해요 번창하시고 번창 하세여 감사드려요
```

### 활용 용도
메뉴 리뷰를 자동으로 생성하여 마케팅 자료로 활용할 수 있다. 나아가, 데이터를 배달 음식 리뷰가 아닌 제품, 서비스 리뷰 데이터를 추가하여 학습하면 추후 출시될 신제품, 서비스의 마케팅 자료로 활용하기에 좋다.

+ 적용 사례
  - [네이버 커머스 솔루션마켓 CLOVA 메시지마케팅](https://solution.smartstore.naver.com/ko/solution/2NDiArqyVW4mYsqcXUoXYJ/detail) : 스토어 정보, 쿠폰, 판매 상품, 메시지 소재 등 다양한 정보를 활용하여 HyperCLOVA가 3종의 마케팅 메시지(제목, 내용)를 자동으로 생성
  - [현대백화점의 루이스(Lewis)](https://n.news.naver.com/mnews/article/025/0003262163?sid=101) : 판촉행사 소개문 작성 등 마케팅 문구제작에 특화된 현대백화점의 사내 카피라이팅 시스템'
  - [뤼튼](https://wrtn.ai/): 간단한 키워드만으로 완성도 높은 광고카피, 제품 소개 문구를 작성할 수 있는 AI 카피라이팅 서비스
  - [킵그로우](https://app.keepgrow.com/admin/products/category/65) : 네이버 스마트스토어 기반으로 고객사의 인스타그램 계정에 게시물을 주기적으로 포스팅 해주는 '인스타그램 Ai 피드 포스팅' 기능

[참고자료] [네이버 클라우드 플랫폼 블로글](https://blog.naver.com/n_cloudplatform/222913297671)
